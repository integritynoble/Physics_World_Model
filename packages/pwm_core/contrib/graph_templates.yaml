# =============================================================================
# PWM Graph Templates Registry
# Skeleton graphs for all 26 modalities.
# Each template: graph_id, description, nodes, edges, learnable params.
#
# CT + Widefield templates are complete enough to compile and pass adjoint checks.
#
# ID format: <modality>_graph_v<N> (lowercase, underscores only)
# See docs/contracts/registry_conventions.md
# =============================================================================

version: "1.0"

templates:

  # ===========================================================================
  # MICROSCOPY
  # ===========================================================================

  widefield_graph_v1:
    description: "Widefield fluorescence microscopy: PSF convolution + noise"
    metadata:
      modality: widefield
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 2.0
          mode: reflect
        learnable: [sigma]
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: blur
        target: noise

  widefield_lowdose_graph_v1:
    description: "Low-dose widefield microscopy: heavy PSF blur + high noise"
    metadata:
      modality: widefield_lowdose
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 3.0
          mode: reflect
        learnable: [sigma]
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 1000.0
          read_sigma: 0.05
          seed: 0
    edges:
      - source: blur
        target: noise

  confocal_livecell_graph_v1:
    description: "Live-cell confocal microscopy: tight PSF + low photon budget"
    metadata:
      modality: confocal_livecell
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 1.2
          mode: reflect
        learnable: [sigma]
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 5000.0
          read_sigma: 0.02
          seed: 0
    edges:
      - source: blur
        target: noise

  confocal_3d_graph_v1:
    description: "3D confocal microscopy: volumetric PSF convolution"
    metadata:
      modality: confocal_3d
      x_shape: [32, 64, 64]
      y_shape: [32, 64, 64]
    nodes:
      - node_id: blur_3d
        primitive_id: conv3d
        params:
          sigma: [3.0, 1.5, 1.5]
          mode: reflect
        learnable: [sigma]
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 8000.0
          read_sigma: 0.02
          seed: 0
    edges:
      - source: blur_3d
        target: noise

  sim_graph_v1:
    description: "Structured illumination microscopy: pattern modulation + PSF + integration"
    metadata:
      modality: sim
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: pattern
        primitive_id: sim_pattern
        params:
          H: 64
          W: 64
          freq: 0.1
          angle: 0.0
          phase: 0.0
        learnable: [freq, angle, phase]
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 1.5
          mode: reflect
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: pattern
        target: blur
      - source: blur
        target: noise

  lightsheet_graph_v1:
    description: "Light-sheet microscopy: axial sectioning + lateral PSF"
    metadata:
      modality: lightsheet
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 1.0
          mode: reflect
        learnable: [sigma]
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 15000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: blur
        target: noise

  # ===========================================================================
  # COMPRESSIVE / SPECTRAL
  # ===========================================================================

  cassi_graph_v1:
    description: "Single-disperser CASSI: coded mask + spectral dispersion + integration + noise"
    metadata:
      modality: cassi
      x_shape: [64, 64, 8]
      y_shape: [64, 64]
    nodes:
      - node_id: modulate
        primitive_id: coded_mask
        params:
          seed: 42
          H: 64
          W: 64
        learnable: []
      - node_id: disperse
        primitive_id: spectral_dispersion
        params:
          disp_step: 1.0
        learnable: [disp_step]
      - node_id: integrate
        primitive_id: frame_integration
        params:
          axis: -1
          T: 8
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: modulate
        target: disperse
      - source: disperse
        target: integrate
      - source: integrate
        target: noise

  spc_graph_v1:
    description: "Single-pixel camera: random measurement matrix"
    metadata:
      modality: spc
      x_shape: [64, 64]
      y_shape: [614]
    nodes:
      - node_id: measure
        primitive_id: random_mask
        params:
          seed: 42
          H: 64
          W: 64
          sampling_rate: 0.15
      - node_id: noise
        primitive_id: gaussian
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: measure
        target: noise

  cacti_graph_v1:
    description: "CACTI snapshot compressive imaging: temporal coded mask + integration"
    metadata:
      modality: cacti
      x_shape: [64, 64, 8]
      y_shape: [64, 64]
    nodes:
      - node_id: mask
        primitive_id: temporal_mask
        params:
          H: 64
          W: 64
          T: 8
          seed: 42
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: mask
        target: noise

  matrix_graph_v1:
    description: "Generic matrix operator (A @ x): random measurement"
    metadata:
      modality: matrix
      x_shape: [64, 64]
      y_shape: [1024]
    nodes:
      - node_id: project
        primitive_id: random_mask
        params:
          seed: 42
          H: 64
          W: 64
          sampling_rate: 0.25
      - node_id: noise
        primitive_id: gaussian
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: project
        target: noise

  # ===========================================================================
  # TOMOGRAPHY / MRI
  # ===========================================================================

  ct_graph_v1:
    description: "CT: Radon transform (sinogram projection) + noise"
    metadata:
      modality: ct
      x_shape: [64, 64]
      y_shape: [180, 64]
    nodes:
      - node_id: radon
        primitive_id: ct_radon
        params:
          n_angles: 180
          H: 64
          W: 64
        learnable: []
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 100000.0
          read_sigma: 0.005
          seed: 0
    edges:
      - source: radon
        target: noise

  mri_graph_v1:
    description: "MRI: k-space undersampling + noise"
    metadata:
      modality: mri
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: kspace
        primitive_id: mri_kspace
        params:
          H: 64
          W: 64
          sampling_rate: 0.25
          seed: 42
        learnable: []
      - node_id: noise
        primitive_id: gaussian
        params:
          sigma: 0.005
          seed: 0
    edges:
      - source: kspace
        target: noise

  # ===========================================================================
  # PHASE / HOLOGRAPHY / COHERENT
  # ===========================================================================

  ptychography_graph_v1:
    description: "Ptychography: probe modulation + Fresnel propagation + intensity detection"
    metadata:
      modality: ptychography
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: probe
        primitive_id: coded_mask
        params:
          seed: 42
          H: 64
          W: 64
        learnable: []
      - node_id: propagate
        primitive_id: fresnel_prop
        params:
          wavelength: 0.5e-6
          distance: 1.0e-3
          pixel_size: 1.0e-6
        learnable: [distance]
      - node_id: detect
        primitive_id: magnitude_sq
        params: {}
      - node_id: noise
        primitive_id: poisson
        params:
          peak_photons: 10000.0
          seed: 0
    edges:
      - source: probe
        target: propagate
      - source: propagate
        target: detect
      - source: detect
        target: noise

  holography_graph_v1:
    description: "Off-axis digital holography: propagation + reference interference + detection"
    metadata:
      modality: holography
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: propagate
        primitive_id: fresnel_prop
        params:
          wavelength: 0.633e-6
          distance: 5.0e-3
          pixel_size: 3.45e-6
        learnable: [distance]
      - node_id: detect
        primitive_id: magnitude_sq
        params: {}
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 50000.0
          read_sigma: 0.005
          seed: 0
    edges:
      - source: propagate
        target: detect
      - source: detect
        target: noise

  phase_retrieval_graph_v1:
    description: "Phase retrieval (CDI): Fourier modulus measurement"
    metadata:
      modality: phase_retrieval
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: propagate
        primitive_id: angular_spectrum
        params:
          wavelength: 0.5e-6
          distance: 1.0e-3
          pixel_size: 1.0e-6
      - node_id: detect
        primitive_id: magnitude_sq
        params: {}
      - node_id: noise
        primitive_id: poisson
        params:
          peak_photons: 10000.0
          seed: 0
    edges:
      - source: propagate
        target: detect
      - source: detect
        target: noise

  fpm_graph_v1:
    description: "Fourier ptychographic microscopy: multi-angle illumination + low-NA capture"
    metadata:
      modality: fpm
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: illuminate
        primitive_id: sim_pattern
        params:
          H: 64
          W: 64
          freq: 0.05
          angle: 0.0
          phase: 0.0
        learnable: [freq, angle]
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 3.0
          mode: reflect
      - node_id: detect
        primitive_id: magnitude_sq
        params: {}
      - node_id: noise
        primitive_id: poisson
        params:
          peak_photons: 10000.0
          seed: 0
    edges:
      - source: illuminate
        target: blur
      - source: blur
        target: detect
      - source: detect
        target: noise

  # ===========================================================================
  # RENDERING / 3D
  # ===========================================================================

  nerf_graph_v1:
    description: "NeRF volumetric rendering: ray tracing + integration"
    metadata:
      modality: nerf
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: trace
        primitive_id: ray_trace
        params:
          focal_length: 50.0
          magnification: 1.0
      - node_id: noise
        primitive_id: gaussian
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: trace
        target: noise

  gaussian_splatting_graph_v1:
    description: "3D Gaussian splatting: projection + PSF + noise"
    metadata:
      modality: gaussian_splatting
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: project
        primitive_id: ray_trace
        params:
          focal_length: 35.0
          magnification: 1.0
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 1.0
          mode: constant
      - node_id: noise
        primitive_id: gaussian
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: project
        target: blur
      - source: blur
        target: noise

  # ===========================================================================
  # LENSLESS / COMPUTATIONAL
  # ===========================================================================

  lensless_graph_v1:
    description: "Lensless imaging: PSF convolution (from calibrated mask/diffuser)"
    metadata:
      modality: lensless
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: psf_conv
        primitive_id: conv2d
        params:
          sigma: 5.0
          mode: constant
        learnable: [sigma]
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 20000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: psf_conv
        target: noise

  panorama_graph_v1:
    description: "Panoramic imaging: geometric warping + stitching blur"
    metadata:
      modality: panorama
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: warp
        primitive_id: motion_warp
        params:
          dx: 2.0
          dy: 1.0
        learnable: [dx, dy]
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 1.0
          mode: reflect
      - node_id: noise
        primitive_id: gaussian
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: warp
        target: blur
      - source: blur
        target: noise

  light_field_graph_v1:
    description: "Light field: multi-view integration + disparity shift"
    metadata:
      modality: light_field
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: shift
        primitive_id: motion_warp
        params:
          dx: 0.5
          dy: 0.5
        learnable: [dx, dy]
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 1.5
          mode: reflect
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 20000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: shift
        target: blur
      - source: blur
        target: noise

  # ===========================================================================
  # BIOMEDICAL IMAGING
  # ===========================================================================

  dot_graph_v1:
    description: "Diffuse optical tomography: diffusion + boundary detection"
    metadata:
      modality: dot
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: diffuse
        primitive_id: conv2d
        params:
          sigma: 8.0
          mode: constant
        learnable: [sigma]
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 5000.0
          read_sigma: 0.02
          seed: 0
    edges:
      - source: diffuse
        target: noise

  photoacoustic_graph_v1:
    description: "Photoacoustic imaging: optical absorption + acoustic propagation"
    metadata:
      modality: photoacoustic
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: absorb
        primitive_id: identity
        params: {}
      - node_id: propagate
        primitive_id: conv2d
        params:
          sigma: 3.0
          mode: constant
        learnable: [sigma]
      - node_id: noise
        primitive_id: gaussian
        params:
          sigma: 0.02
          seed: 0
    edges:
      - source: absorb
        target: propagate
      - source: propagate
        target: noise

  oct_graph_v1:
    description: "OCT: spectral interferometry + log compression"
    metadata:
      modality: oct
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: interfere
        primitive_id: identity
        params: {}
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 1.0
          mode: reflect
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 50000.0
          read_sigma: 0.005
          seed: 0
    edges:
      - source: interfere
        target: blur
      - source: blur
        target: noise

  flim_graph_v1:
    description: "Fluorescence lifetime imaging: temporal decay + gated detection"
    metadata:
      modality: flim
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 2.0
          mode: reflect
        learnable: [sigma]
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 3000.0
          read_sigma: 0.03
          seed: 0
    edges:
      - source: blur
        target: noise

  integral_graph_v1:
    description: "Integral imaging: microlens array + multi-view integration"
    metadata:
      modality: integral
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: shift
        primitive_id: motion_warp
        params:
          dx: 0.3
          dy: 0.3
        learnable: [dx, dy]
      - node_id: blur
        primitive_id: conv2d
        params:
          sigma: 2.0
          mode: reflect
      - node_id: noise
        primitive_id: poisson_gaussian
        params:
          peak_photons: 15000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: shift
        target: blur
      - source: blur
        target: noise

  # ===========================================================================
  # V2 TEMPLATES — Canonical Chain: Source → Element(s) → Sensor → Noise
  # All 26 modalities with explicit source/sensor/noise nodes.
  # ===========================================================================

  # ---------------------------------------------------------------------------
  # MICROSCOPY (v2)
  # ---------------------------------------------------------------------------

  widefield_graph_v2:
    description: "Widefield fluorescence microscopy: Source→PSF→Sensor→Noise"
    metadata:
      modality: widefield
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 2.0
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: blur
      - source: blur
        target: sensor
      - source: sensor
        target: noise

  widefield_lowdose_graph_v2:
    description: "Low-dose widefield microscopy: Source→heavy PSF→Sensor→high Noise"
    metadata:
      modality: widefield_lowdose
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 3.0
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 1000.0
          read_sigma: 0.05
          seed: 0
    edges:
      - source: source
        target: blur
      - source: blur
        target: sensor
      - source: sensor
        target: noise

  confocal_livecell_graph_v2:
    description: "Live-cell confocal microscopy: Source→tight PSF→Sensor→Noise"
    metadata:
      modality: confocal_livecell
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 1.2
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 5000.0
          read_sigma: 0.02
          seed: 0
    edges:
      - source: source
        target: blur
      - source: blur
        target: sensor
      - source: sensor
        target: noise

  confocal_3d_graph_v2:
    description: "3D confocal microscopy: Source→volumetric PSF→Sensor→Noise"
    metadata:
      modality: confocal_3d
      canonical_chain: true
      x_shape: [32, 64, 64]
      y_shape: [32, 64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: blur_3d
        primitive_id: conv3d
        role: transport
        params:
          sigma: [3.0, 1.5, 1.5]
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 8000.0
          read_sigma: 0.02
          seed: 0
    edges:
      - source: source
        target: blur_3d
      - source: blur_3d
        target: sensor
      - source: sensor
        target: noise

  sim_graph_v2:
    description: "Structured illumination microscopy: Source→pattern+PSF→Sensor→Noise"
    metadata:
      modality: sim
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: pattern
        primitive_id: sim_pattern
        role: transport
        params:
          H: 64
          W: 64
          freq: 0.1
          angle: 0.0
          phase: 0.0
        learnable: [freq, angle, phase]
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 1.5
          mode: reflect
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: pattern
      - source: pattern
        target: blur
      - source: blur
        target: sensor
      - source: sensor
        target: noise

  lightsheet_graph_v2:
    description: "Light-sheet microscopy: Source→lateral PSF→Sensor→Noise"
    metadata:
      modality: lightsheet
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 1.0
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 15000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: blur
      - source: blur
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # COMPRESSIVE / SPECTRAL (v2)
  # ---------------------------------------------------------------------------

  cassi_graph_v2:
    description: >
      SD-CASSI (ECCV-2020): Source→ObjectiveLens→CodedMask→RelayLens1→
      SpectralDispersion→ImbalancedResponse→RelayLens2→FrameIntegration→
      Sensor→Noise.  Extended output Nx×(Ny+(Nλ-1)·step).
    metadata:
      modality: cassi
      canonical_chain: true
      sd_cassi_eccv2020: true
      x_shape: [64, 64, 8]
      y_shape: [64, 78]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: objective
        primitive_id: objective_lens
        role: transport
        params:
          throughput: 0.92
          psf_sigma: 0.0
      - node_id: modulate
        primitive_id: coded_mask
        role: transport
        params:
          seed: 42
          H: 64
          W: 64
        learnable: []
      - node_id: relay1
        primitive_id: relay_lens
        role: transport
        params:
          throughput: 0.90
      - node_id: disperse
        primitive_id: spectral_dispersion
        role: transport
        params:
          disp_step: 2.0
          disp_axis: 1
          extended_output: true
        learnable: [disp_step]
      - node_id: sd_distortion
        primitive_id: imbalanced_response
        role: transport
        params:
          a2: 0.0
          disp_axis: 1
      - node_id: relay2
        primitive_id: relay_lens
        role: transport
        params:
          throughput: 0.90
      - node_id: integrate
        primitive_id: frame_integration
        role: transport
        params:
          axis: -1
          T: 8
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: objective
      - source: objective
        target: modulate
      - source: modulate
        target: relay1
      - source: relay1
        target: disperse
      - source: disperse
        target: sd_distortion
      - source: sd_distortion
        target: relay2
      - source: relay2
        target: integrate
      - source: integrate
        target: sensor
      - source: sensor
        target: noise

  spc_graph_v2:
    description: "Single-pixel camera: Source→random mask→Sensor→Noise"
    metadata:
      modality: spc
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [614]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: measure
        primitive_id: random_mask
        role: transport
        params:
          seed: 42
          H: 64
          W: 64
          sampling_rate: 0.15
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: measure
      - source: measure
        target: sensor
      - source: sensor
        target: noise

  cacti_graph_v2:
    description: "CACTI snapshot compressive imaging: Source→temporal mask→Sensor→Noise"
    metadata:
      modality: cacti
      canonical_chain: true
      x_shape: [64, 64, 8]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: mask
        primitive_id: temporal_mask
        role: transport
        params:
          H: 64
          W: 64
          T: 8
          seed: 42
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: mask
      - source: mask
        target: sensor
      - source: sensor
        target: noise

  matrix_graph_v2:
    description: "Generic matrix operator: Source→random mask→Sensor→Noise"
    metadata:
      modality: matrix
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [1024]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: project
        primitive_id: random_mask
        role: transport
        params:
          seed: 42
          H: 64
          W: 64
          sampling_rate: 0.25
      - node_id: sensor
        primitive_id: generic_sensor
        role: sensor
        params:
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: project
      - source: project
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # LENSLESS / COMPUTATIONAL (v2)
  # ---------------------------------------------------------------------------

  lensless_graph_v2:
    description: "Lensless imaging: Source→PSF convolution→Sensor→Noise"
    metadata:
      modality: lensless
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: psf_conv
        primitive_id: conv2d
        role: transport
        params:
          sigma: 5.0
          mode: constant
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 20000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: psf_conv
      - source: psf_conv
        target: sensor
      - source: sensor
        target: noise

  panorama_graph_v2:
    description: "Panoramic imaging: Source→defocus+integration→Sensor→Noise"
    metadata:
      modality: panorama
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: defocus
        primitive_id: conv2d
        role: transport
        params:
          sigma: 1.0
          mode: reflect
        learnable: [sigma]
      - node_id: integrate
        primitive_id: frame_integration
        role: transport
        params:
          axis: 0
          T: 1
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: defocus
      - source: defocus
        target: integrate
      - source: integrate
        target: sensor
      - source: sensor
        target: noise

  light_field_graph_v2:
    description: "Light field imaging: Source→microlens PSF→Sensor→Noise"
    metadata:
      modality: light_field
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 1.5
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 20000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: blur
      - source: blur
        target: sensor
      - source: sensor
        target: noise

  integral_graph_v2:
    description: "Integral imaging: Source→lenslet PSF→Sensor→Noise"
    metadata:
      modality: integral
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 2.0
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 15000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: blur
      - source: blur
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # TOMOGRAPHY / MRI (v2)
  # ---------------------------------------------------------------------------

  ct_graph_v2:
    description: "CT: Source→Radon(sampling)→Beer-Lambert(transduction)→Sensor→Noise"
    metadata:
      modality: ct
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [180, 64]
    nodes:
      - node_id: source
        primitive_id: xray_source
        role: source
        params:
          strength: 1.0
      - node_id: radon
        primitive_id: ct_radon
        role: transport
        params:
          n_angles: 180
          H: 64
          W: 64
        learnable: []
      - node_id: beer_lambert
        primitive_id: beer_lambert
        role: transport
        params:
          I_0: 10000.0
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_only_sensor
        role: noise
        params:
          peak_photons: 100000.0
          seed: 0
    edges:
      - source: source
        target: radon
      - source: radon
        target: beer_lambert
      - source: beer_lambert
        target: sensor
      - source: sensor
        target: noise

  mri_graph_v2:
    description: "MRI: Source→k-space undersampling→Coil sensor→Complex noise"
    metadata:
      modality: mri
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: spin_source
        role: source
        params:
          strength: 1.0
      - node_id: kspace
        primitive_id: mri_kspace
        role: transport
        params:
          H: 64
          W: 64
          sampling_rate: 0.25
          seed: 42
        learnable: []
      - node_id: sensor
        primitive_id: coil_sensor
        role: sensor
        params:
          sensitivity: 1.0
      - node_id: noise
        primitive_id: complex_gaussian_sensor
        role: noise
        params:
          sigma: 0.005
          seed: 0
    edges:
      - source: source
        target: kspace
      - source: kspace
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # PHASE / HOLOGRAPHY / COHERENT (v2)
  # ---------------------------------------------------------------------------

  ptychography_graph_v2:
    description: "Ptychography: Source→probe+propagation+intensity→Sensor→Noise"
    metadata:
      modality: ptychography
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: probe
        primitive_id: coded_mask
        role: transport
        params:
          seed: 42
          H: 64
          W: 64
        learnable: []
      - node_id: propagate
        primitive_id: fresnel_prop
        role: transport
        params:
          wavelength: 0.5e-6
          distance: 1.0e-3
          pixel_size: 1.0e-6
        learnable: [distance]
      - node_id: detect
        primitive_id: magnitude_sq
        role: transport
        params: {}
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: probe
      - source: probe
        target: propagate
      - source: propagate
        target: detect
      - source: detect
        target: sensor
      - source: sensor
        target: noise

  holography_graph_v2:
    description: "Digital holography: Source→Fresnel propagation→Sensor→Noise"
    metadata:
      modality: holography
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: propagate
        primitive_id: fresnel_prop
        role: transport
        params:
          wavelength: 0.633e-6
          distance: 5.0e-3
          pixel_size: 3.45e-6
        learnable: [distance]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 50000.0
          read_sigma: 0.005
          seed: 0
    edges:
      - source: source
        target: propagate
      - source: propagate
        target: sensor
      - source: sensor
        target: noise

  phase_retrieval_graph_v2:
    description: "Phase retrieval (CDI): Source→angular spectrum+intensity→Sensor→Noise"
    metadata:
      modality: phase_retrieval
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: propagate
        primitive_id: angular_spectrum
        role: transport
        params:
          wavelength: 0.5e-6
          distance: 1.0e-3
          pixel_size: 1.0e-6
      - node_id: detect
        primitive_id: magnitude_sq
        role: transport
        params: {}
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: propagate
      - source: propagate
        target: detect
      - source: detect
        target: sensor
      - source: sensor
        target: noise

  fpm_graph_v2:
    description: "Fourier ptychographic microscopy: Source→angular spectrum+intensity→Sensor→Noise"
    metadata:
      modality: fpm
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: propagate
        primitive_id: angular_spectrum
        role: transport
        params:
          wavelength: 0.5e-6
          distance: 1.0e-3
          pixel_size: 1.0e-6
      - node_id: detect
        primitive_id: magnitude_sq
        role: transport
        params: {}
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: propagate
      - source: propagate
        target: detect
      - source: detect
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # RENDERING / 3D (v2)
  # ---------------------------------------------------------------------------

  nerf_graph_v2:
    description: "NeRF volumetric rendering: Source→volume rendering(tier3)→Sensor→Noise"
    metadata:
      modality: nerf
      canonical_chain: true
      physics_tier: tier3_learned
      x_shape: [16, 64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: volume_render
        primitive_id: volume_rendering_stub
        role: transport
        params:
          n_views: 1
          render_mode: mip
      - node_id: sensor
        primitive_id: generic_sensor
        role: sensor
        params:
          gain: 1.0
      - node_id: noise
        primitive_id: gaussian_sensor_noise
        role: noise
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: volume_render
      - source: volume_render
        target: sensor
      - source: sensor
        target: noise

  gaussian_splatting_graph_v2:
    description: "3D Gaussian splatting: Source→splatting(tier3)→Sensor→Noise"
    metadata:
      modality: gaussian_splatting
      canonical_chain: true
      physics_tier: tier3_learned
      x_shape: [16, 64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: splat
        primitive_id: gaussian_splatting_stub
        role: transport
        params:
          n_views: 1
          image_size: [64, 64]
      - node_id: sensor
        primitive_id: generic_sensor
        role: sensor
        params:
          gain: 1.0
      - node_id: noise
        primitive_id: gaussian_sensor_noise
        role: noise
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: splat
      - source: splat
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # BIOMEDICAL IMAGING (v2)
  # ---------------------------------------------------------------------------

  flim_graph_v2:
    description: "Fluorescence lifetime imaging: Source→PSF+temporal gate→Sensor→Noise"
    metadata:
      modality: flim
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 2.0
          mode: reflect
        learnable: [sigma]
      - node_id: gate
        primitive_id: temporal_mask
        role: transport
        params:
          H: 64
          W: 64
          T: 1
          seed: 42
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 3000.0
          read_sigma: 0.03
          seed: 0
    edges:
      - source: source
        target: blur
      - source: blur
        target: gate
      - source: gate
        target: sensor
      - source: sensor
        target: noise

  photoacoustic_graph_v2:
    description: "Photoacoustic: Source→OpticalAbsorption(photon→acoustic)→AcousticProp→Transducer→GaussianNoise"
    metadata:
      modality: photoacoustic
      canonical_chain: true
      carrier_transitions: ["photon->acoustic"]
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: absorption
        primitive_id: optical_absorption
        role: interaction
        params:
          grueneisen: 0.8
          mu_a: 1.0
        learnable: [grueneisen, mu_a]
      - node_id: propagate
        primitive_id: acoustic_propagation
        role: transport
        params:
          speed_of_sound: 1500.0
          n_sensors: 64
          x_shape: [64, 64]
      - node_id: sensor
        primitive_id: transducer_sensor
        role: sensor
        params:
          sensitivity: 1.0
      - node_id: noise
        primitive_id: gaussian_sensor_noise
        role: noise
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: absorption
      - source: absorption
        target: propagate
      - source: propagate
        target: sensor
      - source: sensor
        target: noise

  oct_graph_v2:
    description: "OCT: Source→angular spectrum propagation→Sensor→Noise"
    metadata:
      modality: oct
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: propagate
        primitive_id: angular_spectrum
        role: transport
        params:
          wavelength: 1.3e-6
          distance: 1.0e-3
          pixel_size: 5.0e-6
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 50000.0
          read_sigma: 0.005
          seed: 0
    edges:
      - source: source
        target: propagate
      - source: propagate
        target: sensor
      - source: sensor
        target: noise

  dot_graph_v2:
    description: "Diffuse optical tomography: Source→diffusion PSF→Sensor→Noise"
    metadata:
      modality: dot
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: diffuse
        primitive_id: conv2d
        role: transport
        params:
          sigma: 8.0
          mode: constant
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.9
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 5000.0
          read_sigma: 0.02
          seed: 0
    edges:
      - source: source
        target: diffuse
      - source: diffuse
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # MEDICAL MODALITIES (v2) — Phase 3
  # ---------------------------------------------------------------------------

  xray_radiography_graph_v2:
    description: "X-ray radiography: Source→Beer-Lambert→Scatter(opt)→XRayDetector→PoissonGaussianNoise"
    metadata:
      modality: xray_radiography
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: xray_source
        role: source
        params:
          strength: 1.0
      - node_id: transmission
        primitive_id: beer_lambert
        role: transport
        params:
          I_0: 10000.0
      - node_id: scatter
        primitive_id: scatter_model
        role: transport
        params:
          scatter_fraction: 0.1
          kernel_sigma: 5.0
      - node_id: sensor
        primitive_id: xray_detector_sensor
        role: sensor
        params:
          scintillator_efficiency: 0.8
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 50000.0
          read_sigma: 0.005
          seed: 0
    edges:
      - source: source
        target: transmission
      - source: transmission
        target: scatter
      - source: scatter
        target: sensor
      - source: sensor
        target: noise

  ultrasound_graph_v2:
    description: "Ultrasound: AcousticSource→AcousticPropagation→BeamformDelay→AcousticReceive→GaussianNoise"
    metadata:
      modality: ultrasound
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64]
    nodes:
      - node_id: source
        primitive_id: acoustic_source
        role: source
        params:
          strength: 1.0
      - node_id: propagate
        primitive_id: acoustic_propagation
        role: transport
        params:
          speed_of_sound: 1540.0
          n_sensors: 32
          x_shape: [64, 64]
      - node_id: beamform
        primitive_id: beamform_delay
        role: transport
        params:
          n_elements: 32
      - node_id: sensor
        primitive_id: acoustic_receive_sensor
        role: sensor
        params:
          sensitivity: 1.0
      - node_id: noise
        primitive_id: gaussian_sensor_noise
        role: noise
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: propagate
      - source: propagate
        target: beamform
      - source: beamform
        target: sensor
      - source: sensor
        target: noise

  pet_graph_v2:
    description: "PET: GenericSource(emission)→EmissionProjection→ScatterModel→PhotonSensor→PoissonOnlyNoise"
    metadata:
      modality: pet
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [32, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: projection
        primitive_id: emission_projection
        role: transport
        params:
          n_angles: 32
          x_shape: [64, 64]
      - node_id: scatter
        primitive_id: scatter_model
        role: transport
        params:
          scatter_fraction: 0.15
          kernel_sigma: 3.0
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.85
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_only_sensor
        role: noise
        params:
          peak_photons: 100000.0
          seed: 0
    edges:
      - source: source
        target: projection
      - source: projection
        target: scatter
      - source: scatter
        target: sensor
      - source: sensor
        target: noise

  spect_graph_v2:
    description: "SPECT: GenericSource(emission)→EmissionProjection→PhotonSensor→PoissonOnlyNoise"
    metadata:
      modality: spect
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [32, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: projection
        primitive_id: emission_projection
        role: transport
        params:
          n_angles: 32
          x_shape: [64, 64]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.85
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_only_sensor
        role: noise
        params:
          peak_photons: 100000.0
          seed: 0
    edges:
      - source: source
        target: projection
      - source: projection
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # ELECTRON MICROSCOPY (v2) — Phase 4
  # ---------------------------------------------------------------------------

  sem_graph_v2:
    description: "SEM: ElectronBeamSource→YieldModel(SE)→ElectronDetector→GaussianNoise"
    metadata:
      modality: sem
      canonical_chain: true
      requires_x_interaction: true
      physics_fidelity:
        tier: tier0_geometry
        validity_regime: "homogeneous_material, normal_incidence, no_charging"
        known_limitations: ["No Monte Carlo scattering", "No topographic contrast model"]
        upgrade_path: "tier1_approx: angular-dependent yield; tier2_full: MC electron transport"
    nodes:
      - node_id: source
        primitive_id: electron_beam_source
        role: source
        params: {accelerating_voltage_kv: 15.0, beam_current_na: 1.0}
      - node_id: interaction
        primitive_id: yield_model
        role: transport
        params: {yield_coeff: 0.1, detector_type: "SE"}
      - node_id: sensor
        primitive_id: electron_detector_sensor
        role: sensor
        params: {detector_type: "SE", collection_efficiency: 0.5, gain: 100.0}
      - node_id: noise
        primitive_id: gaussian_sensor_noise
        role: noise
        params: {sigma: 0.01}
    edges:
      - source: source
        target: interaction
      - source: interaction
        target: sensor
      - source: sensor
        target: noise

  tem_graph_v2:
    description: "TEM: ElectronBeamSource→ThinObjectPhase→CTFTransfer→ElectronDetector→GaussianNoise"
    metadata:
      modality: tem
      canonical_chain: true
      requires_x_interaction: true
      physics_fidelity:
        tier: tier1_approx
        validity_regime: "thin_sample, weak_phase, isoplanatic_CTF"
        known_limitations: ["No multislice (dynamical)", "No partial coherence envelope"]
        upgrade_path: "tier2_full: multislice + partial coherence"
    nodes:
      - node_id: source
        primitive_id: electron_beam_source
        role: source
        params: {accelerating_voltage_kv: 200.0, beam_current_na: 0.1}
      - node_id: interaction
        primitive_id: thin_object_phase
        role: transport
        params: {sigma: 0.00729, thickness_nm: 10.0}
      - node_id: ctf
        primitive_id: ctf_transfer
        role: transport
        params: {defocus_nm: -50.0, Cs_mm: 1.0, wavelength_pm: 2.5}
      - node_id: sensor
        primitive_id: electron_detector_sensor
        role: sensor
        params: {detector_type: "BF", collection_efficiency: 0.8, gain: 1.0}
      - node_id: noise
        primitive_id: gaussian_sensor_noise
        role: noise
        params: {sigma: 0.01}
    edges:
      - source: source
        target: interaction
      - source: interaction
        target: ctf
      - source: ctf
        target: sensor
      - source: sensor
        target: noise

  electron_tomography_graph_v2:
    description: "Electron Tomography: ElectronBeamSource→ThinObjectPhase→ElectronDetector→GaussianNoise"
    metadata:
      modality: electron_tomography
      canonical_chain: true
      requires_x_interaction: true
      physics_fidelity:
        tier: tier1_approx
        validity_regime: "thin_sample, weak_phase, single_tilt_axis"
    nodes:
      - node_id: source
        primitive_id: electron_beam_source
        role: source
        params: {accelerating_voltage_kv: 300.0, beam_current_na: 0.1}
      - node_id: interaction
        primitive_id: thin_object_phase
        role: transport
        params: {sigma: 0.00729, thickness_nm: 50.0}
      - node_id: sensor
        primitive_id: electron_detector_sensor
        role: sensor
        params: {detector_type: "BF", collection_efficiency: 0.7, gain: 1.0}
      - node_id: noise
        primitive_id: gaussian_sensor_noise
        role: noise
        params: {sigma: 0.02}
    edges:
      - source: source
        target: interaction
      - source: interaction
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # X-RAY VARIANTS (v2) — R1
  # ---------------------------------------------------------------------------

  fluoroscopy_graph_v2:
    description: "Fluoroscopy: XRaySource→BeerLambert→TemporalIntegrator→XRayDetector→PoissonGaussianNoise"
    metadata:
      modality: fluoroscopy
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: xray_source
        role: source
        params:
          strength: 1.0
      - node_id: transmission
        primitive_id: beer_lambert
        role: transport
        params:
          I_0: 5000.0
      - node_id: temporal_int
        primitive_id: fluoro_temporal_integrator
        role: transport
        params:
          n_frames: 8
          decay: 0.9
      - node_id: sensor
        primitive_id: xray_detector_sensor
        role: sensor
        params:
          scintillator_efficiency: 0.7
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 20000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: transmission
      - source: transmission
        target: temporal_int
      - source: temporal_int
        target: sensor
      - source: sensor
        target: noise

  mammography_graph_v2:
    description: "Mammography: XRaySource→BeerLambert→PhotonSensor→PoissonGaussianNoise"
    metadata:
      modality: mammography
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: xray_source
        role: source
        params:
          strength: 1.0
      - node_id: transmission
        primitive_id: beer_lambert
        role: transport
        params:
          I_0: 8000.0
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.85
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 30000.0
          read_sigma: 0.008
          seed: 0
    edges:
      - source: source
        target: transmission
      - source: transmission
        target: sensor
      - source: sensor
        target: noise

  dexa_graph_v2:
    description: "DEXA: XRaySource→DualEnergyBeerLambert→PhotonSensor→PoissonGaussianNoise"
    metadata:
      modality: dexa
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: xray_source
        role: source
        params:
          strength: 1.0
      - node_id: dual_transmission
        primitive_id: dual_energy_beer_lambert
        role: transport
        params:
          I_0_low: 5000.0
          I_0_high: 8000.0
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.85
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 25000.0
          read_sigma: 0.008
          seed: 0
    edges:
      - source: source
        target: dual_transmission
      - source: dual_transmission
        target: sensor
      - source: sensor
        target: noise

  cbct_graph_v2:
    description: "CBCT: XRaySource→Radon→BeerLambert→PhotonSensor→PoissonOnlyNoise"
    metadata:
      modality: cbct
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [180, 64]
    nodes:
      - node_id: source
        primitive_id: xray_source
        role: source
        params:
          strength: 1.0
      - node_id: radon
        primitive_id: ct_radon
        role: transport
        params:
          n_angles: 180
          H: 64
          W: 64
        learnable: []
      - node_id: beer_lambert
        primitive_id: beer_lambert
        role: transport
        params:
          I_0: 8000.0
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.85
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_only_sensor
        role: noise
        params:
          peak_photons: 50000.0
          seed: 0
    edges:
      - source: source
        target: radon
      - source: radon
        target: beer_lambert
      - source: beer_lambert
        target: sensor
      - source: sensor
        target: noise

  angiography_graph_v2:
    description: "Angiography: XRaySource→BeerLambert→TemporalIntegrator→XRayDetector→PoissonGaussianNoise"
    metadata:
      modality: angiography
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: xray_source
        role: source
        params:
          strength: 1.0
      - node_id: transmission
        primitive_id: beer_lambert
        role: transport
        params:
          I_0: 6000.0
      - node_id: temporal_int
        primitive_id: fluoro_temporal_integrator
        role: transport
        params:
          n_frames: 4
          decay: 0.85
      - node_id: sensor
        primitive_id: xray_detector_sensor
        role: sensor
        params:
          scintillator_efficiency: 0.75
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 30000.0
          read_sigma: 0.008
          seed: 0
    edges:
      - source: source
        target: transmission
      - source: transmission
        target: temporal_int
      - source: temporal_int
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # ULTRASOUND MODES (v2) — R2
  # ---------------------------------------------------------------------------

  doppler_ultrasound_graph_v2:
    description: "Doppler Ultrasound: AcousticSource→AcousticPropagation→DopplerEstimator→AcousticReceive→GaussianNoise"
    metadata:
      modality: doppler_ultrasound
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64]
    nodes:
      - node_id: source
        primitive_id: acoustic_source
        role: source
        params:
          strength: 1.0
      - node_id: propagate
        primitive_id: acoustic_propagation
        role: transport
        params:
          speed_of_sound: 1540.0
          n_sensors: 32
          x_shape: [64, 64]
      - node_id: doppler
        primitive_id: doppler_estimator
        role: transport
        params:
          prf_hz: 10000.0
          wall_filter_cutoff: 50.0
      - node_id: sensor
        primitive_id: acoustic_receive_sensor
        role: sensor
        params:
          sensitivity: 1.0
      - node_id: noise
        primitive_id: gaussian_sensor_noise
        role: noise
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: propagate
      - source: propagate
        target: doppler
      - source: doppler
        target: sensor
      - source: sensor
        target: noise

  elastography_graph_v2:
    description: "Elastography: AcousticSource→ElasticWaveModel→AcousticPropagation→AcousticReceive→GaussianNoise"
    metadata:
      modality: elastography
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64]
    nodes:
      - node_id: source
        primitive_id: acoustic_source
        role: source
        params:
          strength: 1.0
      - node_id: elastic
        primitive_id: elastic_wave_model
        role: transport
        params:
          shear_speed_m_per_s: 3.0
          push_duration_us: 100.0
      - node_id: propagate
        primitive_id: acoustic_propagation
        role: transport
        params:
          speed_of_sound: 1540.0
          n_sensors: 32
          x_shape: [64, 64]
      - node_id: sensor
        primitive_id: acoustic_receive_sensor
        role: sensor
        params:
          sensitivity: 1.0
      - node_id: noise
        primitive_id: gaussian_sensor_noise
        role: noise
        params:
          sigma: 0.015
          seed: 0
    edges:
      - source: source
        target: elastic
      - source: elastic
        target: propagate
      - source: propagate
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # MRI APPLICATIONS (v2) — R3
  # ---------------------------------------------------------------------------

  fmri_graph_v2:
    description: "fMRI: SpinSource→MRIkSpace→SequenceBlock→CoilSensor→ComplexGaussianNoise"
    metadata:
      modality: fmri
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: spin_source
        role: source
        params:
          strength: 1.0
      - node_id: kspace
        primitive_id: mri_kspace
        role: transport
        params:
          H: 64
          W: 64
          sampling_rate: 0.50
          seed: 42
        learnable: []
      - node_id: sequence
        primitive_id: sequence_block
        role: transport
        params:
          TR_ms: 2000.0
          TE_ms: 30.0
          flip_angle_deg: 90.0
      - node_id: sensor
        primitive_id: coil_sensor
        role: sensor
        params:
          sensitivity: 1.0
      - node_id: noise
        primitive_id: complex_gaussian_sensor
        role: noise
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: kspace
      - source: kspace
        target: sequence
      - source: sequence
        target: sensor
      - source: sensor
        target: noise

  mrs_graph_v2:
    description: "MRS: SpinSource→MRIkSpace→SequenceBlock→CoilSensor→ComplexGaussianNoise"
    metadata:
      modality: mrs
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: spin_source
        role: source
        params:
          strength: 1.0
      - node_id: kspace
        primitive_id: mri_kspace
        role: transport
        params:
          H: 64
          W: 64
          sampling_rate: 1.0
          seed: 42
        learnable: []
      - node_id: sequence
        primitive_id: sequence_block
        role: transport
        params:
          TR_ms: 3000.0
          TE_ms: 135.0
          flip_angle_deg: 90.0
      - node_id: sensor
        primitive_id: coil_sensor
        role: sensor
        params:
          sensitivity: 1.0
      - node_id: noise
        primitive_id: complex_gaussian_sensor
        role: noise
        params:
          sigma: 0.02
          seed: 0
    edges:
      - source: source
        target: kspace
      - source: kspace
        target: sequence
      - source: sequence
        target: sensor
      - source: sensor
        target: noise

  diffusion_mri_graph_v2:
    description: "Diffusion MRI: SpinSource→MRIkSpace→CoilSensor→ComplexGaussianNoise"
    metadata:
      modality: diffusion_mri
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: spin_source
        role: source
        params:
          strength: 1.0
      - node_id: kspace
        primitive_id: mri_kspace
        role: transport
        params:
          H: 64
          W: 64
          sampling_rate: 0.30
          seed: 42
        learnable: []
      - node_id: sensor
        primitive_id: coil_sensor
        role: sensor
        params:
          sensitivity: 1.0
      - node_id: noise
        primitive_id: complex_gaussian_sensor
        role: noise
        params:
          sigma: 0.015
          seed: 0
    edges:
      - source: source
        target: kspace
      - source: kspace
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # ADVANCED OPTICAL MICROSCOPY (v2) — R4
  # ---------------------------------------------------------------------------

  two_photon_graph_v2:
    description: "Two-photon microscopy: Source→NonlinearExcitation→PSF→Sensor→Noise"
    metadata:
      modality: two_photon
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: excitation
        primitive_id: nonlinear_excitation
        role: transport
        params:
          n_photons: 2
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 1.5
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.45
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 5000.0
          read_sigma: 0.02
          seed: 0
    edges:
      - source: source
        target: excitation
      - source: excitation
        target: blur
      - source: blur
        target: sensor
      - source: sensor
        target: noise

  sted_graph_v2:
    description: "STED microscopy: Source→SaturationDepletion→PSF→Sensor→Noise"
    metadata:
      modality: sted
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: depletion
        primitive_id: saturation_depletion
        role: transport
        params:
          depletion_factor: 0.5
          psf_sigma: 1.0
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 0.8
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.45
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 3000.0
          read_sigma: 0.03
          seed: 0
    edges:
      - source: source
        target: depletion
      - source: depletion
        target: blur
      - source: blur
        target: sensor
      - source: sensor
        target: noise

  palm_storm_graph_v2:
    description: "PALM/STORM: Source→BlinkingEmitterModel→Sensor→Noise"
    metadata:
      modality: palm_storm
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: emitters
        primitive_id: blinking_emitter
        role: transport
        params:
          density: 0.1
          photons_per_emitter: 1000
          seed: 42
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.90
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 1000.0
          read_sigma: 0.05
          seed: 0
    edges:
      - source: source
        target: emitters
      - source: emitters
        target: sensor
      - source: sensor
        target: noise

  tirf_graph_v2:
    description: "TIRF microscopy: Source→EvanescentFieldDecay→PSF→Sensor→Noise"
    metadata:
      modality: tirf
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: evanescent
        primitive_id: evanescent_decay
        role: transport
        params:
          penetration_depth: 100.0
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 1.2
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.90
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 8000.0
          read_sigma: 0.015
          seed: 0
    edges:
      - source: source
        target: evanescent
      - source: evanescent
        target: blur
      - source: blur
        target: sensor
      - source: sensor
        target: noise

  polarization_graph_v2:
    description: "Polarization microscopy: Source→PSF→Sensor→Noise"
    metadata:
      modality: polarization
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: blur
        primitive_id: conv2d
        role: transport
        params:
          sigma: 1.8
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.85
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 12000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: blur
      - source: blur
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # CLINICAL OPTICS (v2) — R5
  # ---------------------------------------------------------------------------

  endoscopy_graph_v2:
    description: "Endoscopy: Source→FiberBundle→SpecularReflection→PhotonSensor→PoissonGaussianNoise"
    metadata:
      modality: endoscopy
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: fiber_bundle
        primitive_id: fiber_bundle_sensor
        role: transport
        params:
          n_cores: 10000
          core_pitch: 10.0
          coupling_efficiency: 0.3
          seed: 42
      - node_id: specular
        primitive_id: specular_reflection
        role: transport
        params:
          specular_strength: 0.1
          roughness: 0.5
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.75
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 8000.0
          read_sigma: 0.02
          seed: 0
    edges:
      - source: source
        target: fiber_bundle
      - source: fiber_bundle
        target: specular
      - source: specular
        target: sensor
      - source: sensor
        target: noise

  fundus_graph_v2:
    description: "Fundus camera: Source→RetinalPSF→PhotonSensor→PoissonGaussianNoise"
    metadata:
      modality: fundus
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: retinal_psf
        primitive_id: conv2d
        role: transport
        params:
          sigma: 1.5
          mode: reflect
        learnable: [sigma]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.80
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 15000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: retinal_psf
      - source: retinal_psf
        target: sensor
      - source: sensor
        target: noise

  octa_graph_v2:
    description: "OCT Angiography: Source→AngularSpectrum→VesselFlowContrast→PhotonSensor→PoissonGaussianNoise"
    metadata:
      modality: octa
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: propagate
        primitive_id: angular_spectrum
        role: transport
        params:
          wavelength: 0.84e-6
          distance: 1.0e-3
          pixel_size: 5.0e-6
      - node_id: flow_contrast
        primitive_id: vessel_flow_contrast
        role: transport
        params:
          n_frames: 4
          threshold: 0.1
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.85
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 30000.0
          read_sigma: 0.008
          seed: 0
    edges:
      - source: source
        target: propagate
      - source: propagate
        target: flow_contrast
      - source: flow_contrast
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # DEPTH / TOF IMAGING (v2) — R6
  # ---------------------------------------------------------------------------

  tof_camera_graph_v2:
    description: "ToF Camera: Source→TimeOfFlightGate→SPADToFSensor→PoissonGaussianNoise"
    metadata:
      modality: tof_camera
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: tof_gate
        primitive_id: tof_gate
        role: transport
        params:
          n_bins: 64
          bin_width_ns: 1.0
          timing_jitter_ns: 0.1
      - node_id: sensor
        primitive_id: spad_tof_sensor
        role: sensor
        params:
          n_bins: 64
          dead_time_ns: 50.0
          qe: 0.3
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 5000.0
          read_sigma: 0.02
          seed: 0
    edges:
      - source: source
        target: tof_gate
      - source: tof_gate
        target: sensor
      - source: sensor
        target: noise

  lidar_graph_v2:
    description: "LiDAR: Source→ScanTrajectory→TimeOfFlightGate→SPADToFSensor→PoissonGaussianNoise"
    metadata:
      modality: lidar
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: scan
        primitive_id: scan_trajectory
        role: transport
        params:
          scan_type: raster
          n_points: 64
          dwell_time: 1.0
      - node_id: tof_gate
        primitive_id: tof_gate
        role: transport
        params:
          n_bins: 64
          bin_width_ns: 0.5
          timing_jitter_ns: 0.05
      - node_id: sensor
        primitive_id: spad_tof_sensor
        role: sensor
        params:
          n_bins: 64
          dead_time_ns: 20.0
          qe: 0.25
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 3000.0
          read_sigma: 0.03
          seed: 0
    edges:
      - source: source
        target: scan
      - source: scan
        target: tof_gate
      - source: tof_gate
        target: sensor
      - source: sensor
        target: noise

  structured_light_graph_v2:
    description: "Structured Light: Source→StructuredLightProjector→DepthOptics→PhotonSensor→PoissonGaussianNoise"
    metadata:
      modality: structured_light
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: photon_source
        role: source
        params:
          strength: 1.0
      - node_id: projector
        primitive_id: structured_light_projector
        role: transport
        params:
          n_patterns: 4
          fringe_freq: 8.0
      - node_id: depth_optics
        primitive_id: depth_optics
        role: transport
        params:
          focal_length: 50.0
          aperture: 2.8
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.80
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 20000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: projector
      - source: projector
        target: depth_optics
      - source: depth_optics
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # RADAR / SONAR (v2) — R7
  # ---------------------------------------------------------------------------

  sar_graph_v2:
    description: "SAR: GenericSource→SARBackprojection→GenericSensor→ComplexGaussianNoise"
    metadata:
      modality: sar
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: backproject
        primitive_id: sar_backprojection
        role: transport
        params:
          n_pulses: 64
          swath_width: 100.0
      - node_id: sensor
        primitive_id: generic_sensor
        role: sensor
        params:
          gain: 1.0
      - node_id: noise
        primitive_id: complex_gaussian_sensor
        role: noise
        params:
          sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: backproject
      - source: backproject
        target: sensor
      - source: sensor
        target: noise

  sonar_graph_v2:
    description: "Sonar: AcousticSource→BeamformDelay→TransducerSensor→PoissonGaussianNoise"
    metadata:
      modality: sonar
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64]
    nodes:
      - node_id: source
        primitive_id: acoustic_source
        role: source
        params:
          strength: 1.0
      - node_id: beamform
        primitive_id: beamform_delay
        role: transport
        params:
          n_elements: 32
      - node_id: sensor
        primitive_id: transducer_sensor
        role: sensor
        params:
          sensitivity: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.02
          seed: 0
    edges:
      - source: source
        target: beamform
      - source: beamform
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # ELECTRON SPECTROSCOPY / DIFFRACTION (v2) — R8
  # ---------------------------------------------------------------------------

  electron_diffraction_graph_v2:
    description: "4D-STEM: GenericSource→DiffractionCamera→EnergyResolvingDetector→PoissonGaussianNoise"
    metadata:
      modality: electron_diffraction
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: diffract
        primitive_id: diffraction_camera
        role: transport
        params:
          detector_psf_sigma: 0.5
      - node_id: sensor
        primitive_id: energy_resolving_detector
        role: sensor
        params:
          n_channels: 256
          energy_range_ev: [0, 2000]
          qe: 0.8
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 10000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: diffract
      - source: diffract
        target: sensor
      - source: sensor
        target: noise

  ebsd_graph_v2:
    description: "EBSD: GenericSource→ReciprocalSpaceGeometry→EnergyResolvingDetector→PoissonGaussianNoise"
    metadata:
      modality: ebsd
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: geometry
        primitive_id: reciprocal_space_geometry
        role: transport
        params:
          sample_tilt_deg: 70.0
          detector_distance: 15.0
      - node_id: sensor
        primitive_id: energy_resolving_detector
        role: sensor
        params:
          n_channels: 256
          energy_range_ev: [0, 2000]
          qe: 0.8
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 8000.0
          read_sigma: 0.015
          seed: 0
    edges:
      - source: source
        target: geometry
      - source: geometry
        target: sensor
      - source: sensor
        target: noise

  eels_graph_v2:
    description: "EELS: GenericSource→EnergyResolvingDetector(filter)→GenericSensor→PoissonGaussianNoise"
    metadata:
      modality: eels
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: spectrometer
        primitive_id: energy_resolving_detector
        role: transport
        params:
          n_channels: 1024
          energy_range_ev: [0, 3000]
          qe: 0.7
      - node_id: sensor
        primitive_id: generic_sensor
        role: sensor
        params:
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 5000.0
          read_sigma: 0.02
          seed: 0
    edges:
      - source: source
        target: spectrometer
      - source: spectrometer
        target: sensor
      - source: sensor
        target: noise

  electron_holography_graph_v2:
    description: "Electron holography: GenericSource→FresnelProp→PhotonSensor→PoissonGaussianNoise"
    metadata:
      modality: electron_holography
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: propagate
        primitive_id: fresnel_prop
        role: transport
        params:
          wavelength: 2.5e-12
          distance: 1.0e-3
          pixel_size: 1.0e-10
        learnable: [distance]
      - node_id: sensor
        primitive_id: photon_sensor
        role: sensor
        params:
          quantum_efficiency: 0.8
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 20000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: propagate
      - source: propagate
        target: sensor
      - source: sensor
        target: noise

  # ---------------------------------------------------------------------------
  # PARTICLE IMAGING (v2) — R9
  # ---------------------------------------------------------------------------

  neutron_tomo_graph_v2:
    description: "Neutron tomo: GenericSource→ParticleAttenuation→GenericSensor→PoissonGaussianNoise"
    metadata:
      modality: neutron_tomo
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: attenuation
        primitive_id: particle_attenuation
        role: transport
        params:
          I_0: 5000.0
          cross_section: 0.05
      - node_id: sensor
        primitive_id: generic_sensor
        role: sensor
        params:
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 20000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: attenuation
      - source: attenuation
        target: sensor
      - source: sensor
        target: noise

  proton_radiography_graph_v2:
    description: "Proton radiography: GenericSource→ParticleAttenuation→MultipleScattering→GenericSensor→PoissonGaussianNoise"
    metadata:
      modality: proton_radiography
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: attenuation
        primitive_id: particle_attenuation
        role: transport
        params:
          I_0: 10000.0
          cross_section: 0.03
      - node_id: scatter
        primitive_id: multiple_scattering
        role: transport
        params:
          sigma: 1.5
      - node_id: sensor
        primitive_id: generic_sensor
        role: sensor
        params:
          gain: 1.0
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 30000.0
          read_sigma: 0.008
          seed: 0
    edges:
      - source: source
        target: attenuation
      - source: attenuation
        target: scatter
      - source: scatter
        target: sensor
      - source: sensor
        target: noise

  muon_tomo_graph_v2:
    description: "Muon tomo: GenericSource→MultipleScattering→TrackDetectorSensor→PoissonGaussianNoise"
    metadata:
      modality: muon_tomo
      canonical_chain: true
      x_shape: [64, 64]
      y_shape: [64, 64]
    nodes:
      - node_id: source
        primitive_id: generic_source
        role: source
        params:
          strength: 1.0
      - node_id: scatter
        primitive_id: multiple_scattering
        role: transport
        params:
          sigma: 2.0
      - node_id: sensor
        primitive_id: track_detector_sensor
        role: sensor
        params:
          n_layers: 8
          efficiency: 0.95
      - node_id: noise
        primitive_id: poisson_gaussian_sensor
        role: noise
        params:
          peak_photons: 15000.0
          read_sigma: 0.01
          seed: 0
    edges:
      - source: source
        target: scatter
      - source: scatter
        target: sensor
      - source: sensor
        target: noise
